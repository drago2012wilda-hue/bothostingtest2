<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/png" href="/logo-placeholder.png">
<link rel="stylesheet" href="/styles.css">
<title>BotHoster</title>
<meta name="title" content="BotHoster ‚Äî Free Discord Bot Hosting">
<meta name="description" content="Host your Discord bots for free with BotHoster! Create, manage, and run your bots effortlessly. Premium plans offer 24/7 uptime and more.">
<meta property="og:type" content="website">

<meta property="og:url" content="https://dcbothoster.onrender.com/">
<meta property="og:title" content="BotHoster ‚Äî Free Discord Bot Hosting">
<meta property="og:description" content="Host your Discord bots for free with BotHoster! Create, manage, and run your bots effortlessly.">
<meta property="og:image" content="https://dcbothoster.onrender.com/banner.png">

<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://dcbothoster.onrender.com/">
<meta property="twitter:title" content="BotHoster ‚Äî Free Discord Bot Hosting">
<meta property="twitter:description" content="Host your Discord bots for free with BotHoster! Create, manage, and run your bots effortlessly.">
<meta property="twitter:image" content="https://dcbothoster.onrender.com/banner.png">

<style>
footer {
  position: fixed;
  bottom: 10px;
  left: 10px;
  font-size: 14px;
  color: #ccc;
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: flex-start;
}
footer a {
  color: #aaa;
  text-decoration: none;
  transition: color 0.2s;
}
footer a:hover {
  color: #fff;
}
.discord-btn {
  background-color: #5865F2;
  color: white !important;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 0 10px rgba(88,101,242,0.4);
  transition: all 0.2s;
}
.discord-btn:hover {
  background-color: #4752C4;
  transform: translateY(-1px);
  box-shadow: 0 0 15px rgba(88,101,242,0.6);
}
.legal-links {
  display: flex;
  gap: 10px;
  align-items: center;
  font-size: 14px;
}
.legal-links a {
  color: #aaa;
  text-decoration: none;
  transition: color 0.2s;
}
.legal-links a:hover {
  color: #fff;
}
</style>
</head>
<body>
<header>
  <div class="left-header">
    <img src="/logo-placeholder.png" class="logo">
    <div class="brand">BotHoster</div>
  </div>
  <div class="actions">
    <div id="premiumBtn" class="premium">üëë Premium</div>
    <button id="addBtn" class="round">+</button>
    <div id="profile" class="profile"></div>
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
</main>

<div id="modal" class="modal hidden">
  <div class="modal-card">
    <h2>Add Bot</h2>
    <input id="botName" placeholder="Bot name">
    <input id="botToken" placeholder="Bot token">
    <select id="botLang">
      <option value="js">JavaScript</option>
      <option value="py" disabled>Python (coming soon)</option>
    </select>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button id="create" class="btn">Create</button>
      <button id="close" class="btn">Close</button>
    </div>
  </div>
</div>

<div id="premiumModal" class="modal hidden">
  <div class="modal-card">
    <h2>Premium</h2>
    <ul class="features">
      <li>Host up to 7 bots</li>
      <li>Run bots 24/7 (Unless Website Updates)</li>
      <li>Priority support</li>
      <li>Automatic backups</li>
    </ul>
    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
     <button id="buyPremium" class="btn">Buy Premium</button>
     <button id="managePremium" class="btn hidden">Manage Subscription</button>
     <button id="closePremium" class="btn">Close</button>
   </div>
  </div>
</div>

<div id="daysBadge" class="days hidden"></div>

<footer>
  <button id="toggleWidget" class="discord-btn" style="margin-bottom: 10px;">
    üëÅÔ∏è Show Discord Widget
  </button>

  <div id="discordWidget" style="display: none;">
    <iframe
      src="https://discord.com/widget?id=1426278808717230186&theme=dark"
      width="350"
      height="500"
      allowtransparency="true"
      frameborder="0"
      sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"
      style="border-radius: 8px; margin-bottom: 10px;"
    ></iframe>
  </div>

  <a href="https://discord.gg/CrgcwyYtYZ" target="_blank" class="discord-btn">
    <img
      src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4ac.svg"
      width="18"
      height="18"
    >
    Join our Discord
  </a>

  <div class="legal-links">
    <a href="/tos.html" target="_blank">Terms of Service</a>
    <span>‚Ä¢</span>
    <a href="/privacy.html" target="_blank">Privacy Policy</a>
  </div>
</footer>



<script type="module">
async function fetchJson(url,opts){const r=await fetch(url,opts);try{return await r.json()}catch{return{}}}
let accessToken=localStorage.getItem('access_token')||''
const fragment=location.hash||''
if(fragment.includes('access_token=')){
  const params=new URLSearchParams(fragment.replace('#','?'))
  accessToken=params.get('access_token')
  localStorage.setItem('access_token',accessToken)
  location.hash=''
}
if(!accessToken)location.href='/login.html'

const userResp = await fetch('https://discord.com/api/users/@me', {
  headers: { Authorization: 'Bearer ' + accessToken }
});

if (!userResp.ok) {
  localStorage.clear();
  location.href = '/login.html';
}

const user = await userResp.json();
localStorage.setItem('user_id', user.id);

const avatarUrl = user.avatar
  ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128`
  : '/assets/default.png';

const userSyncResp = await fetch('/api/user-sync', {
  method: 'POST',
  headers: { 'content-type': 'application/json' },
  body: JSON.stringify({
    id: user.id,
    username: user.username + (user.discriminator ? '#' + user.discriminator : ''),
    avatar_url: avatarUrl
  })
});

const userSyncData = await userSyncResp.json();

if (userSyncData.error && userSyncResp.status === 403) {
  localStorage.setItem('ban_reason', userSyncData.reason || 'No reason provided');
  localStorage.setItem('banned_user', user.username);
  location.href = '/useraccess.html';
  throw new Error('Access blocked: ' + (userSyncData.reason || 'No reason'));
}

await fetch("/api/store-ip", {
  method: "POST",
  headers: { "content-type": "application/json" },
  body: JSON.stringify({ user_id: user.id })
});

const profile = document.getElementById('profile');
profile.style.backgroundImage = `url(${avatarUrl})`;
profile.onclick = () => {
  localStorage.clear();
  location.href = '/login.html';
};

async function load(){
  const userId = localStorage.getItem('user_id')
  const u = await fetchJson('/api/user/' + userId)
  const badge = document.getElementById('daysBadge')
  const manageBtn = document.getElementById('managePremium')
  const buyBtn = document.getElementById('buyPremium')

  if(u.premium && u.days_left > 0){
    badge.classList.remove('hidden')
    badge.innerText = `üëë Premium ‚Äî ${u.days_left} days left`
    manageBtn.classList.remove('hidden')
    buyBtn.classList.add('hidden')
  }else{
    badge.classList.add('hidden')
    manageBtn.classList.add('hidden')
    buyBtn.classList.remove('hidden')
  }

  const bots = await fetchJson('/api/bots/' + userId)
  const grid = document.getElementById('grid')
  grid.innerHTML = ''
  bots.forEach(b => {
    const el = document.createElement('div')
    el.className = 'botcard'
    el.innerHTML = `
      <img src="${b.avatar_url || '/assets/default.png'}">
      <div class="binfo">
        <h3>${b.name || 'Unnamed Bot'}</h3>
        <div class="row">
          <button data-id="${b.id}" class="open btn">Open</button>
          <button data-id="${b.id}" class="run small">Run</button>
          <button data-id="${b.id}" class="stop small">Stop</button>
        </div>
      </div>`
    grid.appendChild(el)
  })

  document.querySelectorAll('.open').forEach(btn => btn.onclick = () => location.href = '/bot.html#' + btn.dataset.id)
  document.querySelectorAll('.run').forEach(btn => btn.onclick = async () => {
    const uid = localStorage.getItem('user_id')
    await fetchJson('/api/start/' + btn.dataset.id, { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify({ user_id: uid }) })
    alert('Started')
  })
  document.querySelectorAll('.stop').forEach(btn => btn.onclick = async () => {
    const uid = localStorage.getItem('user_id')
    await fetchJson('/api/stop/' + btn.dataset.id, { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify({ user_id: uid }) })
    alert('Stopped')
  })
}
document.getElementById('addBtn').onclick=()=>document.getElementById('modal').classList.remove('hidden')
document.getElementById('close').onclick=()=>document.getElementById('modal').classList.add('hidden')
document.getElementById('create').onclick=async()=>{
  const name=document.getElementById('botName').value.trim()
  const token=document.getElementById('botToken').value.trim()
  const language=document.getElementById('botLang').value
  const user_id=localStorage.getItem('user_id')
  if(!token)return alert('Please enter token')
  const res=await fetchJson('/api/add-bot',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({user_id,name,token,language})})
  if(res.error){if(res.error==='limit')alert('Bot limit reached');else alert('Error creating bot');return}
  document.getElementById('modal').classList.add('hidden')
  location.href='/bot.html#'+res.id
}

document.getElementById('premiumBtn').onclick=()=>document.getElementById('premiumModal').classList.remove('hidden')
document.getElementById('closePremium').onclick=()=>document.getElementById('premiumModal').classList.add('hidden')
document.getElementById('buyPremium').onclick = async () => {
  const user_id = localStorage.getItem('user_id');
  const res = await fetchJson('/api/create-checkout', {
    method: 'POST',
    headers: { 'content-type': 'application/json' },
    body: JSON.stringify({ user_id })
  });
  if (res.url) window.location = res.url;
};

document.getElementById('managePremium').onclick = async () => {
  const user_id = localStorage.getItem('user_id');
  const res = await fetchJson('/api/manage-billing', {
    method: 'POST',
    headers: { 'content-type': 'application/json' },
    body: JSON.stringify({ user_id })
  });
  if (res.url) window.location = res.url;
};

if(new URLSearchParams(window.location.search).get('checkout')==='success'){
  setTimeout(()=>{alert('‚úÖ Premium activated!');load()},1000)
}

setInterval(load,3600000)
load()
const toggleBtn = document.getElementById("toggleWidget");
const widget = document.getElementById("discordWidget");

toggleBtn.addEventListener("click", () => {
  const visible = widget.style.display === "block";
  widget.style.display = visible ? "none" : "block";
  toggleBtn.textContent = visible ? "üëÅÔ∏è Show Discord Widget" : "üôà Hide Discord Widget";
});
window.addEventListener("beforeunload", async () => {
  const user_id = localStorage.getItem("user_id");
  if (!user_id) return;

  const u = await fetchJson('/api/user/' + user_id);
  if (u.premium) return;

  const bots = await fetchJson("/api/bots/" + user_id);
  for (const bot of bots) {
    await fetch("/api/stop/" + bot.id, {
      method: "POST",
      headers: { "content-type": "application/json" },
      body: JSON.stringify({ user_id })
    });
  }
});
</script>
</body>
</html>
